@using Voba.WebUI.Areas.Admin.Controllers
@model List<StatusViewModel>

<div class="container my-5">
    <!-- Sayfa Başlığı -->
    <div class="text-center mb-5">
        <h2 class="fw-bold text-dark">📊 Yönetici Paneli</h2>
        <p class="text-muted fs-6">Siparişlerinizi buradan takip edebilirsiniz.</p>
    </div>

    <div class="row g-4">
        <!-- Doughnut Chart -->
        <div class="col-lg-8">
            <div class="card shadow border-0 h-100">
                <div class="card-body text-center">
                    <h5 class="card-title mb-4 text-secondary">Sipariş Durumları</h5>
                    <div style="height:320px;">
                        <canvas id="chartjs-doughnut"></canvas>
                    </div>

                    <!-- Status Counts -->
                    <div class="mt-4">
                        <ul class="list-group list-group-horizontal justify-content-center flex-wrap border-0">
                            @foreach (var item in Model)
                            {
                                string color = item.Status switch
                                {
                                    Voba.Core.Enums.OrderStatus.Beklemede => "#ffc107",      // Sarı
                                    Voba.Core.Enums.OrderStatus.İşletmede => "#0d6efd",      // Mavi
                                    Voba.Core.Enums.OrderStatus.SevkiyataHazır => "#20c997", // Turkuaz
                                    _ => "#6c757d"
                                };
                                <li class="list-group-item d-flex align-items-center mx-2 py-2 px-3 shadow-sm rounded" style="border:none; background:#f8f9fa;">
                                    <span class="me-2 rounded-circle" style="width:15px; height:15px; background-color:@color;"></span>
                                    <strong class="text-dark">@item.Status:</strong>&nbsp;@item.Count
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Takvim ve Saat -->
        <div class="col-lg-4">
            <div class="card shadow border-0 h-100 text-white" style="background: linear-gradient(135deg, #0d6efd, #6f42c1);">
                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                    <h5 class="card-title mb-3">📅 İyi Günler <span style="font-size:0.9em;">🙂</span></h5>
                    <!-- Gün -->
                    <p id="current-weekday" class="fs-1 fw-bold mb-1"></p>
                    <!-- Tarih -->
                    <p id="current-date" class="fs-5 mb-2"></p>
                    <!-- Saat -->
                    <p id="current-time" class="fs-2 fw-bold"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alt Kısımda Özet Kartlar -->
    <div class="row g-4 mt-5">
        <!-- Toplam Sipariş Kartı (Farklı renk: canlı mor) -->
        <div class="col-md-3">
            <div class="card shadow-sm text-center border-start border-4 h-100"
                 style="border-color:#6f42c1; background-color:#6f42c1; color:white; transition: transform 0.2s, box-shadow 0.2s;"
                 onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.2)';"
                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 10px rgba(0,0,0,0.1)';">
                <div class="card-body">
                    <h6 class="text-light">Toplam Sipariş</h6>
                    <h3 class="fw-bold">@Model.Sum(x => x.Count)</h3>
                </div>
            </div>
        </div>

        <!-- Diğer durum kartları -->
        @foreach (var item in Model)
        {
            string baseColor = item.Status switch
            {
                Voba.Core.Enums.OrderStatus.Beklemede => "#ffc107",       // Sarı
                Voba.Core.Enums.OrderStatus.İşletmede => "#0d6efd",       // Mavi
                Voba.Core.Enums.OrderStatus.SevkiyataHazır => "#20c997",  // Turkuaz
                _ => "#6c757d"
            };

            <div class="col-md-3">
                <div class="card shadow-sm text-center border-start border-4 h-100"
                     style="border-color:@baseColor; background-color:@baseColor; color:white; transition: transform 0.2s, box-shadow 0.2s;"
                     onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.2)';"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 10px rgba(0,0,0,0.1)';">
                    <div class="card-body">
                        <h6 class="text-light">@item.Status</h6>
                        <h3 class="fw-bold">@item.Count</h3>
                    </div>
                </div>
            </div>
        }
    </div>

    @section Scripts {
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Doughnut Chart
            var ctx = document.getElementById("chartjs-doughnut").getContext("2d");
            var myDoughnut = new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(m => m.Status.ToString()))),
                    datasets: [{
                        data: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(m => m.Count))),
                        backgroundColor: [
                            "#ffc107", // Beklemede
                            "#0d6efd", // İşletmede
                            "#20c997"  // SevkiyataHazır (Turkuaz)
                        ],
                        borderColor: "#fff",
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: { display: true, position: 'bottom', labels: { color: '#495057', font: { size: 14 } } }
                    }
                }
            });

            // Takvim ve Saat
            function updateDateTime() {
                const now = new Date();
                const optionsDate = { year: 'numeric', month: 'long', day: 'numeric' };
                const optionsWeekday = { weekday: 'long' };

                document.getElementById("current-weekday").textContent = now.toLocaleDateString('tr-TR', optionsWeekday);
                document.getElementById("current-date").textContent = now.toLocaleDateString('tr-TR', optionsDate);
                document.getElementById("current-time").textContent = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }

            setInterval(updateDateTime, 1000);
            updateDateTime();
        </script>
    }
